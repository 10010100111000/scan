# backend/configs/scanners.yaml

# --- 1. 子域名发现 (Subfinder) ---
- config_name: "Subfinder (默认)"
  agent_type: "subdomain"
  command_template: "subfinder -d {target} -silent -oJ"
  output_parser_type: "json_lines"
  data_mapping:
    hostname: "host"
    source: "source"

# --- 2. 端口扫描 (Naabu - 读子域名) ---
# 场景：已知域名，想扫端口
- config_name: "Naabu (子域名端口扫描)"
  agent_type: "portscan"
  target_source: "subdomains"  # 读取数据库中的子域名
  # -top-ports 1000: 扫描常用端口
  command_template: "naabu -top-ports 1000 -json -silent"
  output_parser_type: "json_lines"
  data_mapping:
    ip: "ip"
    port: "port"
    host: "host"

# --- 3. 端口扫描 (Naabu - 读根资产) ---
# 场景：输入是 IP 或 CIDR (如 192.168.1.0/24)
- config_name: "Naabu (IP/CIDR全端口)"
  agent_type: "portscan"
  target_source: "root"        # 直接读取 Asset Name (IP/CIDR)
  command_template: "naabu -p - -json -silent {target}"
  output_parser_type: "json_lines"
  data_mapping:
    ip: "ip"
    port: "port"
    host: "host"

# --- 4. Web 服务探测 (httpx 增强版) ---
- config_name: "httpx (Web资产详情)"
  agent_type: "http"
  target_source: "subdomains"  # 默认读取子域名
  # [修改] 增加 -asn (获取ASN/ISP信息) 和 -cdn (检测CDN)
  command_template: "httpx-pd -sc -title -ip -asn -cdn -json -silent -favicon -tls-grab -tech-detect"
  output_parser_type: "json_lines"
  data_mapping:
    url: "url"
    title: "title"
    status_code: "status_code"
    tech: "tech"
    web_server: "webserver"
    ip: "host"            # httpx 的 host 字段是 IP
    port: "port"
    favicon_hash: "favicon_hash"
    ssl_info: "tls"
    # [新增] ASN/Geo 映射 (需要在 orchestrator 解析)
    asn_id: "asn.as-number"
    asn_org: "asn.as-name"
    isp: "asn.as-name"
    country: "asn.country-code"

# --- 5. Web 服务探测 (httpx - 针对 IP) ---
# 场景：直接对 IP/CIDR 进行 Web 探测
- config_name: "httpx (IP Web探测)"
  agent_type: "http"
  target_source: "root"   # 直接读取 Asset (IP)
  command_template: "echo {target} | httpx -sc -title -ip -asn -json -silent"
  output_parser_type: "json_lines"
  data_mapping:
    url: "url"
    title: "title"
    status_code: "status_code"
    ip: "host"
    port: "port"

# --- 6. 漏洞扫描 (Nuclei) ---
- config_name: "Nuclei (高危漏洞)"
  agent_type: "vulnerability"
  target_source: "subdomains"
  command_template: "nuclei -severity critical,high -silent -jsonl"
  output_parser_type: "json_lines"
  data_mapping:
    vulnerability_name: "info.name"
    severity: "info.severity"
    matched_at: "matched-at"
    template_id: "template-id"
    url: "matched-at"

# --- 7. DNS 解析 (dnsx - 保留备用) ---
- config_name: "dnsx (域名解析)"
  agent_type: "subdomain"
  target_source: "subdomains" # 读库
  command_template: "dnsx -resp -json -silent"
  output_parser_type: "json_lines"
  data_mapping:
    hostname: "host"
    ip: "a"